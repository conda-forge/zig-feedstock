{% set name = "zig" %}
{% set version = "0.13.0" %}
{% set llvm_version = "17" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  - url: https://github.com/ziglang/{{ name }}/archive/refs/tags/{{ version }}.tar.gz
    sha256: d3912858003e340f315224bf177d0f441d86b81f62854f5c141b6d51ab6b5516
    patches:
      - 0001-add-patchelf-zig2.patch  # [linux and x86_64]

  # - folder: zig-bootstrap
  #   url: https://ziglang.org/download/0.12.0/zig-linux-x86_64-0.12.0.tar.xz
  #   sha256: c7ae866b8a76a568e2d5cfd31fe89cdb629bdd161fdd5018b29a4a0a17045cad

build:
  number: 0
  skip: true  # [not unix]
  script_env:
    - LIBC_CONDA_VERSION=2.28

requirements:
  build:
    - {{ compiler('c') }}
    - {{ stdlib("c") }}
    - {{ compiler('cxx') }}
    - {{ stdlib('c') }}
    - cmake >=3.5
    - ninja
  host:
    - clangdev {{ llvm_version }}
    - llvmdev {{ llvm_version }}
    - llvm {{ llvm_version }}
    - lld {{ llvm_version }}
    - libclang-cpp {{ llvm_version }}
    - zlib
    - zstd

test:
  commands:
    - zig version
    - zig zen
    - zig init && zig test test/behavior.zig
  source_files:
    - test

about:
  home: https://ziglang.org/
  license: MIT
  license_family: MIT
  license_file: LICENSE
  summary: Zig is a general-purpose programming language and toolchain for maintaining robust, optimal, and reusable software.
  description: |
    Zig is a general-purpose programming language and toolchain for maintaining robust, optimal, and reusable software.
    Robust: Behavior is correct even for edge cases such as out of memory.
    Optimal: Write programs the best way they can behave and perform.
    Reusable: The same code works in many environments which have different constraints.
    Maintainable: Precisely communicate intent to the compiler and other programmers. 
      The language imposes a low overhead to reading code and is resilient to changing requirements and environments.
  doc_url: https://ziglang.org/documentation/{{ version }}/
  dev_url: https://github.com/ziglang/zig

extra:
  recipe-maintainers:
    - MementoRC
    - xmnlab
