--- CMakeLists.txt.old	2024-06-06 14:05:11.000000000 -0500
+++ CMakeLists.txt	2024-06-22 11:27:13.931633400 -0500
+find_package(xml2)
+find_package(zlib)
+find_package(zstd)
+
 if(ZIG_STATIC_ZLIB)
@@ -163,2 +168,23 @@
     list(APPEND LLVM_LIBRARIES "${ZSTD}")
+else()
+    if (MSVC)
+        find_library(ZSTD NAMES libzstd.a libzstdstatic.a zstd NAMES_PER_DIR)
+        list(APPEND LLVM_LIBRARIES "${ZSTD}")
+    endif()
+endif()
+
+if(ZIG_STATIC_XML2)
+    if (MSVC)
+        list(REMOVE_ITEM LLVM_LIBRARIES "xml2.lib")
+    else()
+        list(REMOVE_ITEM LLVM_LIBRARIES "-lxml2")
+    endif()
+
+    find_library(XML2 NAMES libxml2.a xml2 NAMES_PER_DIR)
+    list(APPEND LLVM_LIBRARIES "${XML2}")
+else()
+    if (MSVC)
+        find_library(XML2 NAMES xml2 libxml2 libxml2.a NAMES_PER_DIR)
+        list(APPEND LLVM_LIBRARIES "${XML2}")
+    endif()
 endif()
@@ -722,3 +748,3 @@
     -fno-rtti
-    -fno-stack-protector
+    # -fno-stack-protector

@@ -729,6 +755,8 @@
     -Wno-comment
+    -Os
   )
 else()
-target_compile_options(zigcpp PRIVATE /Zc:preprocessor)
-set_property(TARGET zigcpp PROPERTY MSVC_RUNTIME_LIBRARY "MultiThreaded")
+  target_compile_options(zigcpp PRIVATE -MD)
+  target_compile_options(zigcpp PRIVATE /Zc:preprocessor)
+  set_property(TARGET zigcpp PROPERTY MSVC_RUNTIME_LIBRARY "MultiThreaded")
 endif()
